services:
  api:
    volumes:
      - ./api:/app
      - api_node_modules:/app/node_modules
    command: sh -c "npm install && npm run db:migrate && npm run dev"
    environment:
      # Chat tracing (dev: enabled by default)
      - CHAT_TRACE_ENABLED=${CHAT_TRACE_ENABLED:-true}
      - CHAT_TRACE_RETENTION_DAYS=${CHAT_TRACE_RETENTION_DAYS:-7}

  ui:
    volumes:
      - ./ui:/app
      - ui_node_modules:/app/node_modules
    environment:
      - VITE_API_BASE_URL=${VITE_API_BASE_URL:-http://localhost:8787/api/v1}

  postgres:
    volumes:
      - ./data/backup:/backups

volumes:
  api_node_modules:
  ui_node_modules:
